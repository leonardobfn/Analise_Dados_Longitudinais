---
title: "Peso de Bezerros"
#author: "Curso de Análise de Dados Longitudinais"
format: html
lang: pt-BR
bibliography: references.bib
execute:
  message: false   # ocultar mensagens
  warning: false   # ocultar warnings
---

# Objetivo do Estudo

O objetivo deste estudo é explorar o **crescimento de bezerros entre a 12ª e a 26ª semana de vida**, utilizando **dados longitudinais com medidas repetidas**. A análise inicial se concentra em **compreender padrões gerais e individuais de crescimento**, identificar **variabilidade entre e dentro dos animais**, e introduzir conceitos fundamentais de **análise de dados longitudinais** por meio da **Análise Exploratória de Dados (AED)**. Exemplo do livro [@morettin2025estatistica]

# 1. Compreensão da Base de Dados

```{r}
require(tidyverse)
# carregando a base de dados
dados = readxl::read_xls("../../Dados/Dados_Livro_Estatistica_e_CD/bezerros.xls")
```

1.  Quantos animais estão na base de dados e quantas medições cada animal possui?

```{r}
glimpse(dados)
```

-   15 animais. Cada animal possui 8 medições

2.  Quantas vezes o peso final (26ª semana) é maior que o peso inicial (12ª semana) para cada animal? Dica: calcular a razão `peso_final / peso_inicial` para cada animal.

```{r}
(razao = dados$t26/dados$t12 )
summary(razao)

```

-   Em média, houve um aumento de 94% nos pesos do bezerro quando comparado a primeira e a última semana

# 2. Visualização Geral do Crescimento

3.  Como o peso de cada animal varia ao longo das semanas? (Faça um gráfico de linhas por animal)

```{r}
# transformando a base para o formato longer
dados.longer = pivot_longer(dados,col=-ind,names_to = "Semanas",values_to = "Peso(Kg)")
head(dados.longer,10)

# Remover o "t"
dados.longer = dados.longer |> mutate(Semanas = str_extract(Semanas,"[0-9]+"))
head(dados.longer,10)

# gráfico 1
ggplot(dados.longer,aes(x=Semanas,y=`Peso(Kg)`,group = ind,colour = factor(ind))) +
  geom_line()+
  geom_point() +
  labs(color="Indivíduo")+
  theme_bw()

# gráfico 2
ggplot(dados.longer,aes(x=Semanas,y=`Peso(Kg)`,group = ind)) +
  geom_line()+
  geom_point() +
  labs(color="Indivíduo")+
  facet_wrap(~ind) + 
  theme_bw()
```

4.  Qual é o peso médio de bezerros em cada semana? Existe grande variabilidade entre os animais? (Boxplot)

```{r}
dados.longer |> 
  group_by(Semanas) |> 
  summarise(media = mean(`Peso(Kg)`),
            desvio_padrao = sd(`Peso(Kg)`),
            cv = desvio_padrao/media)
```

```{r}
#gráfico 1
ggplot(dados.longer,aes(x = Semanas,y=`Peso(Kg)`,colour = Semanas))+
  geom_boxplot()+
  ggplot2::geom_jitter()+
  theme_bw() + 
  theme(legend.position = "none") # removendo a legenda

#gráfico 2
ggplot(dados.longer,aes(x = Semanas,y=`Peso(Kg)`,colour = Semanas))+
  geom_point()+
  theme_bw() + 
  theme(legend.position = "none") # removendo a legenda
  
```

5.  Quais padrões gerais de crescimento podemos observar na média ao longo das semanas?

# 3. Resumo Estatístico por Semana

6.  Qual é a média, mediana, mínimo, máximo e quartis do peso em cada semana?
7.  A variação do peso aumenta, diminui ou se mantém ao longo do tempo?

# 4. Padrões Individuais e Variabilidade

8.  Como diferem as trajetórias individuais de crescimento entre os animais?

```{r}
dados.longer |> 
  group_by(ind) |> 
  summarise(media = mean(`Peso(Kg)`),
            desvio_padrao = sd(`Peso(Kg)`),
            cv = desvio_padrao/media)

```


# 5. Tendências e Correlações

9.  Existe uma tendência geral de crescimento linear ou não-linear? Faça um scaterplot e calcule as correlações.
```{r}
cor(dados[,-1])
plot(dados[,-1])
```

10. Como podemos começar a pensar em **modelos** a partir dessas observações?

# 6. Transformações e Medidas Relativas

11. Como calcular o crescimento relativo (percentual) de cada animal ao longo do período? Considere como referência o peso incial.
```{r}
dados.longer |> 
  group_by(ind) |> 
  summarise(r1 = (`Peso(Kg)`/`Peso(Kg)`[1])-1)
```

12. Ao dividir o peso de cada animal pelo **peso médio da semana** (crescimento relativo à média), que tipo de informação podemos extrair sobre os animais?
```{r}
dados.longer |> 
  group_by(Semanas) |> 
  summarise(media_semana = mean(`Peso(Kg)`),
            r2 = `Peso(Kg)`/media_semana)
```

Se $r2 < 1$ indica que o peso do animal está abaixo da média da semana. Animais com peso_relativo muito acima ou abaixo da média por várias semanas podem indicar algum comportmento atípico. Essa razão também é uma maneira de padronizar os pesos pelo peso médio da semana, dessa forma, todos os animais são comparados na mesma escala relativa. 

```{r}
dados.longer |> 
  group_by(Semanas) |> 
  summarise(media_semana = mean(`Peso(Kg)`),
            r2 = `Peso(Kg)`/media_semana) |>
  group_by(Semanas) |> 
  slice(9)
```

## Outras medidas 
```{r}
dados.longer |> 
  group_by(ind) |> 
  summarise(d = `Peso(Kg)`- `Peso(Kg)`[1])

```

```{r}
library(broom)
dados.longer |>
  group_by(ind) |>
  do(tidy(lm(`Peso(Kg)` ~ as.numeric(Semanas), data = .)))

```


- Como a regressão linear assume relação linear para toda a reta, mas temos dados entre semanas 12 e 26, o intercepto não faz sentido fora dessa faixa.

- $\beta_1$ é a inclinação, ou seja, taxa de crescimento em Kg/semana

- Podemos ter intercepto com interpretação mais realista, nesse caso é preciso centralizar o tempo. Por exemplo, redefinir a semana inicial como zero:
```{r}

dados.longer |>
  mutate(Semana_c = as.numeric(Semanas) - 12) |> 
  group_by(ind) |>
  do(tidy(lm(`Peso(Kg)` ~ Semana_c, data = .)))


```

-O intercepto depende de como definimos a variável tempo.

-Ao centralizar, ganhamos uma interpretação mais útil: o peso previsto no início da observação (semana 12).

-A inclinação não muda, porque a taxa de crescimento é independente da forma como medimos o tempo.

# 7. Discussão e Interpretação

13. Que padrões gerais e individuais de crescimento podem ser observados na turma de bezerros?
14. Quais considerações iniciais podemos tirar sobre a variabilidade entre e dentro de sujeitos?
15. Como essas observações podem guiar a escolha de modelos longitudinais mais avançados?
